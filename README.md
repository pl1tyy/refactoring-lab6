# Лабораторная работа №6 — Рефакторинг и Code Smells

Цель работы — улучшить читаемость, поддерживаемость и структуру кода в файле `order_processing.py` без изменения его внешнего поведения.

## Найденные проблемы качества (Code Smells)

- **Длинный метод**: функция `process_checkout` содержала более 50 строк, смешивая валидацию, бизнес-логику и формирование результата.
- **Магические числа**: использовались «магические» значения вроде `0.10`, `200`, `50`, `0.21` без пояснения их смысла.
- **Сложная условная логика**: расчёт скидок реализован через цепочку вложенных `if-elif`, что затрудняет понимание и расширение.
- **Повторяющаяся проверка купона**: конструкция `coupon is None or coupon == ""` дублируется в логике.
- **Смешение уровней абстракции**: в одной функции происходила и проверка входных данных, и расчёт налогов, и генерация ID заказа.

## Применённые техники рефакторинга

- **Extract Function**: вынесены отдельные функции:
  - `_validate_request()` — проверка обязательных полей
  - `_validate_items()` — валидация списка товаров
  - `_calculate_subtotal()` — подсчёт промежуточной суммы
  - `_calculate_discount()` — расчёт скидки по купону
  - `_generate_order_id()` — генерация идентификатора заказа
- **Replace Magic Number with Symbolic Constant**: все числовые константы вынесены в начало файла с понятными именами (`TAX_RATE`, `MIN_SUBTOTAL_FOR_SAVE20` и др.).
- **Simplify Conditional Expression**: замена `if total < 0: total = 0` на `max(0, subtotal - discount)`.
- **Улучшение читаемости**: использование `f"-строк"` для генерации ID, явные имена переменных, удаление дублирования.
- **Соблюдение принципа KISS**: каждая функция решает одну задачу и легко тестируется.

## Что стало проще читать и менять

- **Добавление нового купона** теперь требует правки только в `_calculate_discount()` — остальной код не затрагивается.
- **Изменение логики валидации** можно проводить изолированно, не боясь сломать расчёт налогов.
- **Тестирование** стало возможным на уровне отдельных функций (в будущем можно написать unit-тесты для `_calculate_discount` и других).
- **Чтение кода** стало линейным: `process_checkout` теперь читается как сценарий — «сначала валидация, потом расчёт, затем формирование ответа».
- **Поддержка** упростилась: любой разработчик быстро поймёт, где находится логика скидок или валидации.

Все существующие тесты проходят — поведение системы сохранено.
